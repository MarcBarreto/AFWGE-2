import csv
import numpy as np

def export_contrafactuals_custom_to_csv(contrafactuals, iris_df, filename='contrafactuals.csv'):
    """
    Exports contrafactual examples to a CSV file in a custom format.

    The CSV file will contain rows of contrafactuals, where each row includes:
    - The original feature values from the input dataset.
    - The contrafactual feature values generated by the algorithm.
    - The corresponding weights assigned to the contrafactual features.

    The headers of the CSV file are formatted to clearly distinguish between original 
    values, contrafactual values, and weights.

    :param contrafactuals: A list of tuples, where each tuple contains the original instance 
                          and its corresponding contrafactual example.
    :param iris_df: The original DataFrame from which the feature names are extracted.
    :param filename: The name of the CSV file to save the contrafactual examples. 
                     Defaults to 'contrafactuals.csv'.
    """
    original_headers = [f'{name}_original' for name in iris_df.columns[:-1]]
    contrafactual_headers = [f'{name}_contrafactual' for name in iris_df.columns[:-1]]
    weight_headers = [f'{name}_weight' for name in iris_df.columns[:-1]]
    
    headers = original_headers + contrafactual_headers + weight_headers

    with open(filename, mode='w', newline='') as file:
        writer = csv.writer(file)
        
        writer.writerow(headers)
        
        for i in range(len(contrafactuals)):
            row =  list(contrafactuals[i][0]) + list(np.round(contrafactuals[i][1], 4))
            writer.writerow(row)
    
    print(f'{filename} saved!')